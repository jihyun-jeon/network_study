# 11장. 클라이언트 식별과 쿠키

<br />

현대의 웹 사이트들은 개인 사용자들에 대해 더 많은 것을 알고 싶어 하고, 기록하고 싶어한다.<br/>
그렇기에 맞춤형으로 사이트를 개인화 시켜서 사용자에게 제공한다!

<br/>

## 1. HTTP헤더

사용자 식별 관련 정보를 전달하는 HTTP 헤더들<br/>

- FROM (요청헤더)<br/>

  - 사용자 이메일 주소 포함함<br/>
  - 스팸 메일 문제가 있어 이 헤더를 보내는 브라우저는 많지x<br/>

- User-Agent(요청헤더)<br/>

  - 사용사가 쓰고있는 브라우저 정보를 서버에게 알려준다.<br/>
  - 특정 사용자 식별하는데 큰 도움되진X

- Referer (요청헤더)<br/>
  - 현재 페이지로 유입하게 한 웹페이지 URL를 가리킴<br/>
  - 사용자가 이전에 어떤 페이지 방문했는지 알려줌 -> 사용자의 취향 파악할 수 있음.<br/>
  - 특정 사용자 식별하는데 큰 도움되진X

<br/>

## 2. 클라이언트 IP주소

- 클라이언트 IP주소 추적으로 알아낸 IP주소로 사용자 식별

- 이 방식은 제대로 동작하지 않아 사용하지X<br/>

- 이유<br/>
  : IP주소는 사용자가 아닌, 컴퓨터를 가리킨다.<br/>
  : 동적으로 IP주소 할당된면 사용자를 식별할 수 없다.<br/>
  : NAT 장비들은 실제 IP주소를 방화벽 뒤에 숨기고, 방화벽 IP주소로 변환한다.<br/>
  : 프락시와 게이트웨이를 사용하는 경우 클라이언트 IP주소 대신, 프락시 서버의 IP주소를 보게된다.<br/>

<br/>

## 3. 사용자 로그인

사용자 로그인 인증을 통한 사용자 식별

사용자 이름,비번을 Authorization 헤더에 넣어 인증하는 방식

<br/>

## 4. 뚱뚱한 URL

fat URL : 사용자의 URL마다 상태 정보를 포함하고 있는 URL

- 하지만 문제가 많음.

- 문제<br/>
  : 못생긴 URL<br/>
  : URL 공유 - URL에 개인정보가 담겨, 공유하지 못한다.<br/>
  : 캐시 - URL이 사용자 정보에 따라 달라져, 캐시를 사용할 수 없다.<br/>
  : 서버 가중 - URL에 해당하는 HTML 페이지를 다시 그려야 함

<br/>

## 5. 쿠키

식별 정보를 지속해서 유지하면서도, 효율적인 기술

- 사용자를 식별하고, 세션 유지하는 방식 중 가장 널리 사용되는 방식이다.

- 모든 브라우저에서 지원됨
  <br/>
  <br/>

### [쿠키 타입]

<b>1. 세션 쿠키</b><br/>

- 임시 쿠키 - 브라우저 닫으면 삭제됨<br/>
- 사용예 - 사용자가 사이트 탐색할때 선호 사항을 저장할 때
  <br/>

<b>2. 지속 쿠키</b><br/>

- 삭제되지 않고 더 길게 유지될 수 있음<br/>
  디스크에 저장되어, 브라우저 닫거나 컴퓨터 재시작해도 남아있음<br/>
- 사용예 - 사용자가 주기적으로 방문하는 사이트에 대한 설정정보, 로그인 이름 유지할 때
  <br/>

<b>둘의 구분 법</b>

- Discard 파라미터 설정ㅇ -> 세션쿠키임
- 파기시간 가리키는 Expires, Max-Age 파라미터 설정ㅇ ->지속쿠키임
  <br/>
  <br/>

### [쿠키 동작]

1. Set-Cookie 응답 헤더에 쿠키가 기술되어 사용자에게 전달됨

2. 브라우저는 서버로 온 Set-Cookie 응답헤더에 있는 쿠키 내용을 브라우저 쿠키 데이터베이스에 저장함.<br/>

   - 브라우저는 쿠키 정보를 저장할 책임이 있다.(HTTP 상태 관리 체계)<br/>
   - 브라우저 마다 다른 방법으로 쿠키를 저장한다. (크롬 : 테이블 같은 형태로 쿠키 정보를 저장해놓는다.)

3. 사용자가 같은 사이트를 미래에 다시 방문하면, 브라우저는 이 쿠키를 요청 헤더에 기술해 전송하게 됨

<br/>
<br/>

### [쿠키 전달]

브라우저는 수백 수천 개의 쿠키를 가지고 있지만, 쿠키 전부를 모든 사이트에 보내지 않는다.

보통 쿠키를 생성한 서버에게만 쿠키 정보를 전달한다.

- Set-Cookie 응답헤더에 Domain 속성 기술해서, 어떤 사이트가 그 쿠키를 읽을 수 있는지 제어할 수 있다.

- Set-Cookie 응답헤더에 Path속성을 기술해서 한 웹사이트에서도 해당 경로에 속하는 특정 페이지만 쿠키를 적용할 수 있다.

ex ) `Set-Cookie : name=value; domain="sample.com"; path=/autos/`

<br/>
<br/>

### [쿠키 구성요소]

응답 헤더 : `Set-Cookie : name=value; [expires=date]; [path=path]; [domain=domain]; [secure]`<br/>
요청 헤더 : `Cookie : name1=value1; name2=value2; ...`

1. name=value (이름=값)<br/>
   : 큰따옴표로 감싸지 않은 문자열 (세미콜론,쉼표,등호,공백 포함하지X)

2. Expires(option)<br/>
   : 쿠키 생명주기 날짜 문자열<br/>
   : 파기 일자에 다다르면 쿠키 삭제되고 전달되지X<br/>
   : expires 명시하지 않으면, 사용자의 세션이 끝날 때 파기됨<br/>

3. Domain(option)<br/>
   : 어떤 사이트가 그 쿠키를 읽을 수 있는지 제어할 수 있다.

4. Path(option)<br/>
   : 서버에 있는 특정 문서에만 쿠키를 할당할 수 있다.<br/>
   : 한 웹사이트에서도 해당 경로에 속하는 특정 페이지만 쿠키를 적용할 수 있다.

5. Secure(option)<br/>
   : SSL 보안 연결 사용할 때만 쿠키 전송한다.

<br/>
<br/>

### [쿠키와 캐싱]

- 브라우저는 일반적으로 쿠키 헤더는 캐싱하지 않고, http응답 본문 response만 캐싱한다.

- 브라우저는 일반적으로 HTTP 응답의 쿠키 헤더(Set-Cookie)를 캐싱하지 않는다.

대신, 브라우저는 서버에서 받은 Set-Cookie 헤더를 읽고 해당 쿠키값만 브라우저의 쿠키 저장소에 저장한다.

<br/>
<br/>

### [그 외]

- HttpOnly 플래그를 설정하여 JavaScript에서 접근할 수 없도록 할 수 있다.

- 쿠키의 보안 취약점을 보완하기 위해 세션이 등장한다.
