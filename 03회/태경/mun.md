# 5장 - 네트워크 계층

- 네트워크 계층 : WAN - 라우터 - IP주소로 통신
- 데이터링크 계층 : LAN - 스위치 - MAC 주소로 통신

## IP 주소

: 어떤 컴퓨터인지 분별하는 고유한 주소

- 공인 IP : 인터넷 연결된 전 세계에서 고유한 주소, 주기적으로 변경됨
- 사설 IP : 인터넷 연결안된 기업 내부에서 사용하는 주소


- `192.168.2.0` - 마지막 1 byte가 `0`이면 ⇒ 네트워크 주소
- `192.168.2.255` - 마지막 1 byte가 `255`면 ⇒ 브로드캐스트 주소
(같은 네트워크에 연결된 다른 컴퓨터에 내 컴퓨터 정보 일괄 전송 시 사용)



### IP 주소 구조

- 4 byte (=32 bit)의 10진수로 표기
- 1 byte 마다 `.` 로 분리되고 0~255까지 나타낼 수 있음
- `192.168.2` `.124`
  네트워크 ID / 호스트 ID

# Classful

클래스로 구분하여 네트워크 범위를 지정하는 IP 주소 체계

- 라우팅 전송 시 서브넷 마스크 전달 안함
- A-E까지 총 5개 클래스 존재
- A,B,C 클래스만 유효 (D: 멀티캐스트, E : 예약 주소)

```jsx
A 클래스 - 네트워크.호스트.호스트.호스트
B 클래스 - 네트워크.네트워크.호스트.호스트
C 클래스 - 네트워크.네트워크.네트워크.호스트
```

1. A 클래스 - 약 16,000,000개

   : 호스트 ID가 가장 많음. 8bit만 네트워크 ID + 24bit 호스트 ID

   - 맨 앞자리 0으로 고정, 0~127
   - 호스트 ID가 많을 수록 할당할 IP도 많음

2. B 클래스 - 약 65,000개

   : 16bit는 네트워크 ID + 16 bit 호스트 ID

   - 앞 두 자리가 10으로 고정, 128~191

3. C 클래스 - 약 250개

   : 24 bit 네트워크 ID + 8 bit 호스트 ID

   - 앞 세 자리 110으로 고정, 192~223

### 문제점

- 클래스별 고정된 IP 개수가 할당 ⇒ 실제 사용하는 IP 개수는 적으면서 비효율적인 IP 할당받아 낭비가 많아짐


💡 인터넷 상용화가 되면서 IP 주소 부족 문제 해결을 위한 방법들이 등장
1. Classless, CIDR
2. NAT, 사설 IP주소
3. IPv6


---

### 데이터 전송방식

1. 브로드캐스트

   : 같은 네트워크에 연결된 모든 컴퓨터에게 데이터 전송

2. 유니캐스트

   : 같은 네트워크에 연결된 특정 컴퓨터의 MAC주소로 1:1 통신

3. 멀티캐스트

   : 같은 네트워크의 특정 그룹의 컴퓨터에만 데이터 전송

---

# Classless

: Class와 상관없이, 전체 IP를 통합하여 필요한 개수만 나눠서 할당

- 라우팅 전송 시 서브넷 마스크 전달함

###

- 서브넷
  : 1개 네트워크가 분할된 작은 네트워크
- 서브넷팅
  : 자원의 효율적인 분배를 위해서 `네트워크 ID / 호스트 ID` 에서 호스트 ID를 `서브넷ID / 호스트ID` 의 작은 네트워크로 쪼개는 작업
  - 쪼갠 서브넷 개수가 적으면 호스트 많아지고 / 서브넷 개수가 많으면 호스트 적어짐

## 서브넷 마스크

: IP주소에서 네트워크 주소와 호스트 주소를 구분하는 구분자

- 네트워크 주소는 1 / 호스트 주소는 0으로 표시
- IP 주소 표기
  192.168.1.1`/24` - /24는 : 1의 값을 갖는 비트 수 = 24bit가 1의 값 가짐
- 서브넷 마스크 표기
  `255.255.255.0` - 10진수로 표현된 기본 마스크. 255는 1의 값을 갖는 10진수

### 라우터 동작방식

스위치 : 같은 네트워크 간 통신 가능한 장비

라우터 : 서로 다른 네트워크 간 통신 위해서 경로 설정하는 장비

라우팅 : 다른 네트워크로 데이터 전달하는 과정

라우팅 테이블 : 데이터를 목적지에 전송하기 위해 네트워크 대상, 방향(인터페이스), 게이트웨이 등 명시한 테이블

- 라우팅 프로토콜에 따라 달라진다.

<br /><br /><br /><br />

# 5장 - 전송 계층

# 전송 계층

## 1. 혼잡 제어 (Congestion Control)

: **네트워크 상태가 혼잡하다면 window size 조절해서 데이터를 전송**한다.

예) 파이프가 얇은데 대량의 물을 보내면 파이프가 터져서 물이 유실되기 때문에, 물 양을 조절한다.

- 타임아웃 발생 시 데이터를 줄여서 전송
- 중복 ACK 여러번 받으면 데이터 줄여서 전송

---

## 2. 흐름 제어 (flow control)

- 정지-대기 : 송신자가 1개 데이터 전송 후 ACK 기다리고 나서 다음 데이터 전송하는 방법

---

## 3. 오류 제어

**오류 검출 방법**

- 확인 응답: 수신자로부터 ACK 받아야 함. 안받으면 오류로 판
- 시간 초과: 특정시간 내 ACK 없으면 세그먼트 오류있다고 판단

**오류 발생 시 데이터 재전송**

- 데이터 유실될 때
- 데이터 순서 변경됐을 때
- 데이터가 훼손될 때

---

- TCP : 연결형, 신뢰성, 정확한 데이터 전송 목표
- UDP : 비연결형, 비신뢰성, 효율적 데이터 전송 목표

1. 3-way handshake - 연결 시작하는 과정
2. 4-way handshake - 연결 종료하는 과정

<img width="651" alt="image" src="https://github.com/jihyun-jeon/network_study/assets/77045939/3f14ac32-58db-47c7-a6a3-f1325a47959f">

<img width="648" alt="스크린샷 2024-03-25 오후 10 10 08" src="https://github.com/jihyun-jeon/network_study/assets/77045939/9c808142-f8da-4b37-9138-00307d305b0f">

# TCP 구조

1. PORT 번호 - 어떤 프로세스/프로그램 인지

> IP Address(어떤 컴퓨터인지), Port(그 중 어떤 프로세스인지)

- 0~1023 : 특정 쓰임을 위한 번호
- 1024~49151 : 기관, 기업이 사용하는 번호
- 49152~65535 : 일반 사용자가 사용하는 번호

- 20 - FTP
- 22 - SSH
- 23 - Telnet : 암호화 안된 텍스트 통신 프로토콜
- 25 - SMTP : 이메일 전송 프로토콜
- 53 - DNS : 도메인 이름 - IP 주소 변환 프로토콜
- 80 - HTTP
- 123 - NTP : 시간 동기화 프로토콜
- 443 - HTTPS

### 일련번호와 확인 응답번호

: 순서 일치 여부, 오류 여부 검사 위해 사용

- 일련번호 : 송신자 → 수신자에 전송할 데이터가 몇 번째인지
- 확인 응답번호 : 수신자가 몇번째 데이터 받았는지 송신자에 알려주는 역할
- 패킷의 크기 - 한번에 전송가능한 데이터 최대 크기

### 윈도우 크기 window size

: 수신자가 받을 수 있는 데이터만큼 송신자가 한번에 보낼 수 있는 데이터의 최대 크기

- 3 way handshake에서 window size 정보 주고 받는다

예) 파이프가 얇은데 대량의 물을 보내면 파이프가 터져서 물이 유실되기 때문에, 물 양을 조절한다.

### 코드 비트

: 기본값 0이고 비트 활성화 시 1

- 항목
  - TURG : 긴급 처리 데이터 있다
  - ACK : 확인 응답 번호
  - RSH : TCP가 받은 데이터를 상위 계층에 전달
  - RST : 연결 재생성
  - SYN : 연결 초기화 위해서 순서번호를 동기화
  - FIN : 데이터 전송위한 연결 종료

# UDP (User Datagram Protocol)

: 수신자 측에서 오류가 있던 없던 상관안하고 데이터 전송

- 신뢰성 보장 안함
- 데이터 전송 속도 빠른
- 예) 실시간 방송, 브로드캐스트
- 헤더 내용
  - 송수신 PORT 번호, 헤더 길이, checksum

# 로드밸런서

: 여러 서버 두어서 사용자가 몰리는 부하를 분산시켜주는 장치

- **방법**
  - 라운드 로빈 : 각 서버별로 연결하는 분배의 기본방식
  - 가중 라운드 로빈 : 각 서버별로 연결하지만 일부 서버는 큰 트래픽 받는 방식
  - 랜덤 : 무작위 분배 방식
  - 해시 : 특정 클라이언트를 특정 서버로 처리하는 방식
  - 포트번호 활용 : 특정 포트번호를 특정 서버로 처리하는 방식
